# 開発情報 (DEVINFO)

## 📋 プロジェクト概要

**Obsidian Better Kanban** は、Obsidian.md のノートを元にカンバンボードを生成し、タスク管理を効率化するプラグインです。Notion や Trello のようなカンバンボードの利便性と、Obsidian.md の柔軟なノート管理機能を組み合わせています。

**重要**: このプラグインは **Obsidian Bases プラグイン** に依存しており、Bases View として動作します。

### 🎯 プロジェクトのゴール

- Obsidian のノート（Markdown ファイル）をカンバンボードとして可視化
- ドラッグ&ドロップで直感的なタスク管理
- Notion Database Board View に近い UX の実現
- Bases プラグインのエコシステムとの統合

---

## ✅ 完了済み機能

### コア機能

- [x] **Bases View 統合**: Bases プラグインのビューとして動作
- [x] **カンバンボード表示**: カラム（列）とカード（タスク）の表示
- [x] **プロパティベースのグループ化**: 任意のプロパティでカラムを作成（例: ステータス、優先度、担当者など）
- [x] **カード表示**: ファイルのタイトルとプロパティを表示
- [x] **カード数カウント**: 各カラムの上にカード件数を表示

### ドラッグ&ドロップ

- [x] **基本的なドラッグ&ドロップ**: カードを別のカラムに移動
- [x] **カラム間移動**: ドロップ時にプロパティ値を自動更新
- [x] **ネストスクロール対応**: `renderClone` による親要素の影響排除
- [x] **位置ずれ問題の解決**: `transform` CSS の影響を排除
- [x] **視覚的フィードバック**: ドラッグ中のハイライト表示

### カード操作

- [x] **新規カード作成**: 各カラムから直接新しいカードを追加
- [x] **タイトルのインライン編集**: カードタイトルをクリックして即座に編集
- [x] **プロパティのインライン編集**: カード上でプロパティ値を直接編集
- [x] **カードクリックでファイルを開く**: Obsidian の通常ビューで開く
- [x] **自動保存**: 編集内容を即座にファイルに反映

### 設定機能

- [x] **ボード固有設定**: 各ボードごとにカスタマイズ可能
- [x] **カラムプロパティ選択**: グループ化するプロパティを選択
- [x] **カードサイズ調整**: Small / Medium / Large の3段階
- [x] **コンパクトモード**: プロパティを非表示にして省スペース表示
- [x] **カード数表示の切り替え**: オン/オフ可能
- [x] **ドラッグ&ドロップの有効/無効**: 必要に応じて無効化可能
- [x] **リアルタイム保存**: Save/Cancel ボタンなしで即座に反映

### プラグイン全体の設定

- [x] **設定タブ**: Obsidian の設定画面に専用タブを追加
- [x] **デフォルト値の管理**: 新規ボード作成時のデフォルト設定

### UI/UX

- [x] **Notion 風デザイン**: モダンで直感的なインターフェース
- [x] **ダークモード対応**: Obsidian のテーマと統一
- [x] **レスポンシブデザイン**: 画面サイズに応じた最適化
- [x] **スムーズなアニメーション**: ホバー、ドラッグ時のフィードバック
- [x] **カスタムスクロールバー**: 統一感のあるデザイン

---

## 🚧 今後実装する機能

### 優先度: 高

- [ ] **カラムの管理**
  - [ ] カラムの追加・削除
  - [ ] カラム名の変更
  - [ ] カラムの並び替え（ドラッグ&ドロップ）

- [ ] **カード詳細ページ**
  - [ ] モーダルまたはサイドパネルで詳細表示
  - [ ] 説明（本文）の編集
  - [ ] 日付（期日など）の編集
  - [ ] タグのマルチセレクト
  - [ ] チェックリスト（サブタスク）
  - [ ] コメント欄

- [ ] **同一カラム内での並び替え**
  - [ ] ドラッグ&ドロップで順序変更
  - [ ] カスタムソート順の保存

- [ ] **カード削除機能**
  - [ ] カードの削除（ファイル削除）
  - [ ] 確認ダイアログ

### 優先度: 中

- [ ] **フィルタ機能**
  - [ ] タグでフィルタ
  - [ ] 担当者でフィルタ
  - [ ] 日付範囲でフィルタ
  - [ ] カスタムフィルタの保存

- [ ] **ソート機能**
  - [ ] 作成日順
  - [ ] 更新日順
  - [ ] タイトル順
  - [ ] カスタム順
  - [ ] ソートプリセットの保存

- [ ] **検索機能**
  - [ ] タイトル・内容からの検索
  - [ ] 検索結果のハイライト

- [ ] **グループ変更**
  - [ ] 表示グループの動的切り替え（例: ステータス → 優先度）
  - [ ] 複数軸でのグループ化（スイムレーン）

### 優先度: 低

- [ ] **高度な機能**
  - [ ] 完了済みカードの自動非表示・グループ化
  - [ ] 期日による自動ハイライト（期限切れ警告）
  - [ ] カラム間でのカード枚数制限（WIP 制限）
  - [ ] テンプレートカード（同じ構成を再利用）
  - [ ] カスタムプロパティの追加

- [ ] **操作履歴**
  - [ ] Undo/Redo 機能

- [ ] **エクスポート**
  - [ ] ボード状態のスナップショット
  - [ ] 画像エクスポート

---

## 🛠️ 技術スタック

### フレームワーク・ライブラリ

| 技術 | バージョン | 用途 |
|------|-----------|------|
| React | 18.x | UI コンポーネント |
| TypeScript | 5.x | 型安全な開発 |
| @hello-pangea/dnd | - | ドラッグ&ドロップ |
| Obsidian API | - | プラグイン基盤 |
| Bases Plugin API | - | ビュー統合 |

### ビルドツール

- **Rollup**: バンドラー
- **Babel**: トランスパイラ
- **ESLint**: リンター

---

## 🏗️ アーキテクチャ

### レイヤー構成

```
┌─────────────────────────────────────┐
│        UI Layer (React)             │  ← ユーザーインターフェース
├─────────────────────────────────────┤
│      View Layer (Bases View)        │  ← Bases プラグイン統合
├─────────────────────────────────────┤
│    Adapter Layer (Data Transform)   │  ← データ変換
├─────────────────────────────────────┤
│      Core Layer (Business Logic)    │  ← ビジネスロジック
├─────────────────────────────────────┤
│     Types Layer (Type Definitions)  │  ← 型定義
└─────────────────────────────────────┘
```

### 主要モジュール

- **`src/index.ts`**: エントリーポイント、プラグイン登録
- **`src/views/kanbanBasesView.ts`**: Bases View 実装
- **`src/core/`**: コアロジック（ファイル操作、プロパティ管理、カード管理）
- **`src/adapters/`**: データ変換（Bases ↔ Kanban）
- **`src/ui/`**: React コンポーネント
- **`src/settings/`**: 設定管理
- **`src/types/`**: 型定義

詳細は `.github/copilot-instructions.md` を参照してください。

---

## 🐛 最近解決した技術的課題

### 1. ネストスクロールコンテナの警告

**問題**: `@hello-pangea/dnd` が「ネストされたスクロールコンテナは非サポート」という警告を表示

**原因**:
- 親要素（`.kanban-board__columns`）が水平スクロール可能
- 子要素（`.kanban-column__cards`）が垂直スクロール可能
- この2層構造がネストスクロールとして検出された

**解決策**:
- `renderClone` を使用してドラッグ中の要素をポータルで別の場所にレンダリング
- これにより親要素のスクロールコンテナの影響を完全に排除

### 2. ドラッグ位置のずれ問題

**問題**: ドラッグ中にカードがマウスカーソルから離れて右斜め下に移動

**原因**: 親要素に `transform` CSS プロパティが設定されていると、`@hello-pangea/dnd` の位置計算がずれる（GitHub Issue #560）

**解決策**:
- `.kanban-card` の `transition` から `transform` を削除
- `renderClone` の使用により、親要素の CSS の影響を完全に排除

**参考**:
- [GitHub Issue #560](https://github.com/hello-pangea/dnd/issues/560): "Draggable items are positioned incorrectly when parent of Droppable has `transform`"

---

## 📊 開発進捗

### 現在のフェーズ: **MVP（最小実用製品）完成**

- ✅ 基本的なカンバンボード表示
- ✅ ドラッグ&ドロップによるカード移動
- ✅ カード・プロパティの編集
- ✅ 設定機能
- 🚧 カラム管理機能（次のマイルストーン）
- 🚧 カード詳細ページ（次のマイルストーン）

### 完成度: **約 40%**

| カテゴリ | 完成度 |
|---------|-------|
| コア機能 | 70% |
| UI/UX | 60% |
| カード操作 | 50% |
| カラム操作 | 20% |
| フィルタ・ソート | 0% |
| 高度な機能 | 0% |

---

## 🧪 テスト状況

- [ ] 単体テスト: 未実装
- [ ] 統合テスト: 未実装
- [x] 手動テスト: 基本機能で実施済み

**今後の課題**: テストフレームワークの導入（Jest + React Testing Library）

---

## 📝 開発ルール

### コーディング規約

1. **型エラーのチェック**: `npm run lint` でエラー0件を維持
2. **JSDoc コメント**: 複雑な関数には必ず付与
3. **TODO コメント**: `// TODO ::: [ ] タスク内容` 形式で記述

### ドキュメント更新

- プロジェクトに変更を加えたら `.github/copilot-instructions.md` を更新
- ファイルの追加・削除・リネーム時は必須
- 主要な関数の追加・変更時は必須

### アンチパターン

- ❌ 巨大コンポーネント（200行超）
- ❌ Prop Drilling
- ❌ useEffect の濫用
- ❌ カード要素やその親要素に `transform` を使用
- ❌ `position: fixed/absolute` の乱用

詳細は `.github/copilot-instructions.md` を参照してください。

---

## 🚀 次のステップ

### 短期目標（1-2週間）

1. カラム管理機能の実装
   - カラムの追加・削除
   - カラム名の変更
   - カラムの並び替え

2. カード詳細ページの実装
   - モーダル UI
   - 詳細情報の編集

### 中期目標（1ヶ月）

1. フィルタ・ソート機能の実装
2. 検索機能の実装
3. テストフレームワークの導入

### 長期目標（3ヶ月）

1. 高度な機能の実装（WIP制限、テンプレートなど）
2. パフォーマンス最適化
3. 公式リリース準備

---

## 📚 参考リソース

### 公式ドキュメント

- [Obsidian Plugin API](https://github.com/obsidianmd/obsidian-api)
- [Obsidian Bases Plugin](https://github.com/jddunn/obsidian-bases)
- [@hello-pangea/dnd Documentation](https://github.com/hello-pangea/dnd)
- [React Documentation](https://react.dev/)

### デザイン参考

- [Notion Database Board View](https://www.notion.so/)
- [Trello](https://trello.com/)

### 技術的な参考

- [GitHub Issue #560 - Transform positioning bug](https://github.com/hello-pangea/dnd/issues/560)
- [React Beautiful DnD positioning issues](https://stackoverflow.com/questions/54982182/react-beautiful-dnd-drag-out-of-position-problem)

---

## 🤝 コントリビューション

現在は個人プロジェクトですが、将来的にはコントリビューションを歓迎する予定です。

---

## 📄 ライセンス

MIT License

---

**最終更新**: 2024年（プロジェクト開始）
**メンテナンス**: Active Development
